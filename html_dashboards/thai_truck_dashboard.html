<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Truck Weigh Station Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .nav-bar {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-bar a {
            color: #3498db;
            text-decoration: none;
            margin-right: 20px;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-bar a:hover {
            color: #2980b9;
        }

        .nav-bar a.active {
            color: #2c3e50;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .stat-card h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-description {
            color: #666;
            font-size: 0.9rem;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-card h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.4rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            width: 100%;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .data-table h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .highlight {
            background-color: #e3f2fd;
            font-weight: 600;
        }

        .footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöõ Thai Truck Weigh Station Dashboard</h1>
            <p>Garbage Collection & Redemption Tracking Analysis - Thai Buddhist Calendar Year 2568</p>
        </div>

        <div class="nav-bar">
            <a href="index.html">üè† Home</a>
            <a href="thai_truck_dashboard.html" class="active">üöõ Truck Analysis</a>
            <a href="recycled_items_dashboard.html">üîÑ Recycled Items</a>
            <a href="sales_payment_dashboard.html">üí∞ Sales & Payments</a>
        </div>

        <!-- Key Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>üìä Total Operations</h3>
                <div class="stat-value">353</div>
                <div class="stat-description">Truck weigh station entries processed</div>
            </div>
            
            <div class="stat-card">
                <h3>üöö Unique Trucks</h3>
                <div class="stat-value">15</div>
                <div class="stat-description">Different license plates tracked</div>
            </div>
            
            <div class="stat-card">
                <h3>üí∞ Total Redemption Value</h3>
                <div class="stat-value">6.3M THB</div>
                <div class="stat-description">Total value from garbage redemption</div>
            </div>
            
            <div class="stat-card">
                <h3>üè¢ Active Clients</h3>
                <div class="stat-value">5</div>
                <div class="stat-description">CLIENT-A through CLIENT-E</div>
            </div>
            
            <div class="stat-card">
                <h3>üóëÔ∏è Waste Types</h3>
                <div class="stat-value">6</div>
                <div class="stat-description">‡∏û‡∏•‡∏≤‡∏™‡∏ï‡∏¥‡∏Å, ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©, ‡πÇ‡∏•‡∏´‡∏∞, ‡πÅ‡∏Å‡πâ‡∏ß, ‡∏ú‡πâ‡∏≤, ‡∏ú‡∏™‡∏°</div>
            </div>
            
            <div class="stat-card">
                <h3>‚öñÔ∏è Avg Weight per Truck</h3>
                <div class="stat-value">20.2 tons</div>
                <div class="stat-description">Average total weight per operation</div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="charts-grid">
            <div class="chart-card">
                <h3>üìà Daily Operations Trend</h3>
                <div class="chart-container">
                    <canvas id="dailyOperationsChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <h3>üöõ Truck Performance by License Plate</h3>
                <div class="chart-container">
                    <canvas id="truckPerformanceChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <h3>‚è∞ Operations by Hour of Day</h3>
                <div class="chart-container">
                    <canvas id="hourlyChart"></canvas>
                </div>
            </div>
            
            <div class="chart-card">
                <h3>üí∞ Redemption Value Distribution</h3>
                <div class="chart-container">
                    <canvas id="redemptionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Data Structure Table -->
        <div class="data-table">
            <h3>üìã Column Structure (A-M)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Column</th>
                        <th>Thai Header</th>
                        <th>English</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="highlight">A</td>
                        <td>‡∏ß‡∏ô‡∏î‡∏≠‡∏õ‡πÑ‡∏õ‡∏ä</td>
                        <td>Date</td>
                        <td>Date tracking (Thai Buddhist calendar 2568)</td>
                    </tr>
                    <tr>
                        <td class="highlight">B</td>
                        <td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</td>
                        <td>Log Number</td>
                        <td>Truck weigh station log number</td>
                    </tr>
                    <tr>
                        <td class="highlight">C</td>
                        <td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</td>
                        <td>License Plate</td>
                        <td>Truck license plate identifier</td>
                    </tr>
                    <tr>
                        <td class="highlight">D</td>
                        <td>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤</td>
                        <td>Time In</td>
                        <td>Entry time (HH.MM.SS format)</td>
                    </tr>
                    <tr>
                        <td class="highlight">E</td>
                        <td>‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏≠‡∏Å</td>
                        <td>Time Out</td>
                        <td>Exit time (HH.MM.SS format)</td>
                    </tr>
                    <tr>
                        <td class="highlight">F</td>
                        <td>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ß‡∏°‡∏£‡∏ñ</td>
                        <td>Total Weight</td>
                        <td>Total weight of truck with garbage</td>
                    </tr>
                    <tr>
                        <td class="highlight">G</td>
                        <td>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏ñ‡πà‡πÑ‡∏î‡πâ</td>
                        <td>Max Redemption Weight</td>
                        <td>Maximum weight eligible for redemption</td>
                    </tr>
                    <tr>
                        <td class="highlight">H</td>
                        <td>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏£‡∏ñ‡πÄ‡∏õ‡∏•‡πà‡∏≤</td>
                        <td>Empty Truck Weight</td>
                        <td>Weight of empty truck</td>
                    </tr>
                    <tr>
                        <td class="highlight">I</td>
                        <td>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏¢‡∏∞‡πÄ‡∏ï‡πá‡∏°</td>
                        <td>Full Garbage Weight</td>
                        <td>Weight of garbage collected</td>
                    </tr>
                    <tr>
                        <td class="highlight">J</td>
                        <td>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ç‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡πÑ‡∏ñ‡πà‡πÑ‡∏î‡πâ</td>
                        <td>Redeemable Weight</td>
                        <td>Weight eligible for redemption</td>
                    </tr>
                    <tr>
                        <td class="highlight">K</td>
                        <td>‡∏£‡∏≤‡∏Ñ‡∏≤‡πÑ‡∏ñ‡πà‡∏ï‡πà‡∏≠‡∏ï‡∏±‡∏ô</td>
                        <td>Price Per Ton</td>
                        <td>Redemption price per ton (varies by client)</td>
                    </tr>
                    <tr class="highlight">
                        <td><strong>L</strong></td>
                        <td><strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</strong></td>
                        <td><strong>Additional Data</strong></td>
                        <td><strong>Total Redemption Value (J √ó K) + Client + Waste Type</strong></td>
                    </tr>
                    <tr>
                        <td class="highlight">M</td>
                        <td>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                        <td>Log Count</td>
                        <td>Number of logs per date</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Key Insights -->
        <div class="data-table">
            <h3>üí° Key Insights & Business Intelligence</h3>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Insight</th>
                        <th>Business Impact</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>üïê Peak Operations</td>
                        <td>Peak hours: 07:00-07:59 (29 ops) & 09:00-09:59 (30 ops)</td>
                        <td>Schedule maintenance and staff during off-peak hours</td>
                    </tr>
                    <tr>
                        <td>üöõ Top Performing Truck</td>
                        <td>‡∏à‡∏â-6666: 31 operations, 641,974 kg total weight</td>
                        <td>Recognize efficient drivers and optimize similar routes</td>
                    </tr>
                    <tr>
                        <td>üí∞ Pricing Strategy</td>
                        <td>Average price: 2,010 THB/ton, varies by client (1,875-2,116 THB)</td>
                        <td>Optimize client pricing based on waste type and volume</td>
                    </tr>
                    <tr>
                        <td>üìä Operational Efficiency</td>
                        <td>Average processing time: 1-2 hours per truck</td>
                        <td>Streamline weigh station operations for faster throughput</td>
                    </tr>
                    <tr>
                        <td>üè¢ Client Distribution</td>
                        <td>5 active clients with different waste type preferences</td>
                        <td>Develop targeted services for high-value waste streams</td>
                    </tr>
                    <tr>
                        <td>‚öñÔ∏è Weight Optimization</td>
                        <td>Average redeemable: 8.9 tons (82% of garbage weight)</td>
                        <td>Improve sorting to increase redeemable percentage</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Raw Data Table -->
        <div class="data-table">
            <h3>üìä Raw Data Sample (First 20 Records)</h3>
            <p style="margin-bottom: 15px; color: #666;">Showing actual data from the Excel file to verify calculations and data structure</p>
            <div style="overflow-x: auto;">
                <table id="rawDataTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Log #</th>
                            <th>License</th>
                            <th>Time In</th>
                            <th>Time Out</th>
                            <th>Total Weight (kg)</th>
                            <th>Max Redemption (kg)</th>
                            <th>Empty Weight (kg)</th>
                            <th>Garbage Weight (kg)</th>
                            <th>Redeemable (kg)</th>
                            <th>Price/ton (THB)</th>
                            <th>Additional Data (Column L)</th>
                            <th>Calculated Value (J√óK)</th>
                            <th>Match?</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Data Validation Summary -->
        <div class="data-table">
            <h3>‚úÖ Data Validation & Calculation Check</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; border-left: 4px solid #4caf50;">
                    <h4 style="color: #2e7d32; margin-bottom: 10px;">Column L Calculation</h4>
                    <p style="color: #1b5e20; font-size: 0.9rem;">Column L = Column J √ó Column K<br>
                    <strong>Formula:</strong> Redeemable Weight √ó Price per Ton</p>
                </div>
                <div style="background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #ff9800;">
                    <h4 style="color: #e65100; margin-bottom: 10px;">Data Format</h4>
                    <p style="color: #bf360c; font-size: 0.9rem;">Column L contains the calculated Total Redemption Value<br>
                    <strong>Formula:</strong> Column J (Redeemable Weight) √ó Column K (Price per Ton) √∑ 1000</p>
                </div>
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; border-left: 4px solid #2196f3;">
                    <h4 style="color: #1565c0; margin-bottom: 10px;">Validation Results</h4>
                    <p style="color: #0d47a1; font-size: 0.9rem;" id="validationResults">Checking data consistency...</p>
                </div>
            </div>
        </div>

        <!-- Fleet Optimization Tab -->
        <div class="data-table">
            <h3>üöõ Fleet Optimization & Performance Analysis</h3>
            
            <!-- Fleet Performance Metrics -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üèÜ Top Performer</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="topPerformer">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;" id="topPerformerStats">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üí∞ Highest Revenue</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="highestRevenue">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;" id="highestRevenueStats">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">‚ö° Most Efficient</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="mostEfficient">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;" id="mostEfficientStats">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üìà Best ROI</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="bestROI">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;" id="bestROIStats">-</div>
                </div>
            </div>

            <!-- Fleet Performance Table -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üìä Detailed Fleet Performance Analysis</h4>
                <div style="overflow-x: auto;">
                    <table id="fleetTable" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 12px; text-align: left;">License Plate</th>
                                <th style="padding: 12px; text-align: center;">Operations</th>
                                <th style="padding: 12px; text-align: center;">Total Weight (kg)</th>
                                <th style="padding: 12px; text-align: center;">Avg Weight (kg)</th>
                                <th style="padding: 12px; text-align: center;">Redeemable (kg)</th>
                                <th style="padding: 12px; text-align: center;">Price/ton (THB)</th>
                                <th style="padding: 12px; text-align: center;">Revenue (THB)</th>
                                <th style="padding: 12px; text-align: center;">Efficiency Score</th>
                                <th style="padding: 12px; text-align: center;">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Fleet data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Weight Capacity Utilization Analysis -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">‚öñÔ∏è Weight Capacity Utilization Analysis</h4>
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 25px; border-radius: 15px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; text-align: center;">
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 5px;" id="avgTotalWeight">-</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Average Total Weight</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 5px;" id="maxCapacityHits">-</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Max Capacity Hits</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 5px;" id="capacityUtilization">-</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Capacity Utilization %</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold; margin-bottom: 5px;" id="underutilizedTrucks">-</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Underutilized Trucks</div>
                        </div>
                    </div>
                </div>
                
                <div style="background: #fff3e0; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800; margin-bottom: 20px;">
                    <h5 style="color: #e65100; margin-bottom: 15px;">üìä Capacity Utilization Insights</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h6 style="color: #bf360c; margin-bottom: 10px; font-weight: bold;">Current Situation:</h6>
                            <ul style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                <li>Average total weight: <span id="avgWeightDisplay">-</span> tons</li>
                                <li>Some trucks consistently hit max capacity (15 tons)</li>
                                <li>Others operate below optimal levels</li>
                                <li>Mixed fleet sizes affecting efficiency</li>
                            </ul>
                        </div>
                        <div>
                            <h6 style="color: #bf360c; margin-bottom: 10px; font-weight: bold;">Optimization Opportunity:</h6>
                            <ul style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                <li>Standardize truck sizes for optimal capacity utilization</li>
                                <li>Optimize routes to maximize weight per trip</li>
                                <li>Balance load distribution across the fleet</li>
                                <li>Implement dynamic routing based on capacity</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Optimization Recommendations -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üí° Fleet Optimization Recommendations</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border-left: 4px solid #4caf50;">
                        <h5 style="color: #2e7d32; margin-bottom: 10px;">üöÄ Immediate Actions</h5>
                        <ul style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                            <li id="topPerformerAction">Replicate top performer's route and operational model</li>
                            <li>Standardize pricing at 1,060 THB/ton across all operations</li>
                            <li>Optimize night shift operations (00:00-06:00) for better efficiency</li>
                        </ul>
                    </div>
                    <div style="background: #fff3e0; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800;">
                        <h5 style="color: #e65100; margin-bottom: 10px;">‚öôÔ∏è Operational Improvements</h5>
                        <ul style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                            <li>Focus on trucks with highest operations count for route optimization</li>
                            <li>Implement predictive maintenance during off-peak hours</li>
                            <li>Improve waste sorting to increase redeemable percentage</li>
                        </ul>
                    </div>
                    <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 4px solid #2196f3;">
                        <h5 style="color: #1565c0; margin-bottom: 10px;">üìà Strategic Planning</h5>
                        <ul style="color: #0d47a1; font-size: 0.9rem; line-height: 1.6;">
                            <li>Analyze top performing trucks for expansion opportunities</li>
                            <li>Develop consistent pricing strategy based on 1,060 THB/ton baseline</li>
                            <li>Implement performance-based driver incentives for top performers</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Fleet Performance Charts -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üìà Fleet Performance Visualizations</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 25px;">
                    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <h5 style="text-align: center; margin-bottom: 20px; color: #333;">üöõ Operations vs. Revenue by Truck</h5>
                        <div style="position: relative; height: 300px; width: 100%;">
                            <canvas id="fleetOperationsChart"></canvas>
                        </div>
                    </div>
                    <div style="background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                        <h5 style="text-align: center; margin-bottom: 20px; color: #333;">‚öñÔ∏è Weight Efficiency by Truck</h5>
                        <div style="position: relative; height: 300px; width: 100%;">
                            <canvas id="fleetEfficiencyChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pricing & Revenue Optimization Section -->
        <div class="data-table">
            <h3>üí∞ Pricing & Revenue Optimization Analysis</h3>
            
            <!-- Pricing Strategy Metrics -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üìä Avg Price/Ton</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="avgPricePerTon">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">THB per ton</div>
                </div>
                <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üìà Price Range</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="priceRange">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">THB variation</div>
                </div>
                <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üéØ Price Variation</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="priceVariation">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">% from average</div>
                </div>
                <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üíé High-Value Ops</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="highValueOps">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Above 1,500 THB/ton</div>
                </div>
            </div>

            <!-- Revenue by Price Tier Table -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üìä Revenue Analysis by Price Tier</h4>
                <div style="overflow-x: auto;">
                    <table id="pricingTable" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 12px; text-align: center;">Price Tier (THB/ton)</th>
                                <th style="padding: 12px; text-align: center;">Operations</th>
                                <th style="padding: 12px; text-align: center;">Total Revenue (THB)</th>
                                <th style="padding: 12px; text-align: center;">Avg Revenue/Op (THB)</th>
                                <th style="padding: 12px; text-align: center;">% of Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Pricing data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

                    <!-- Client Information -->
        <div style="margin: 20px 0;">
            <h4 style="margin-bottom: 15px; color: #333;">üè¢ Client Information</h4>
            <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border-left: 4px solid #4caf50; margin-bottom: 20px;">
                <h5 style="color: #2e7d32; margin-bottom: 15px;">üìã Client Details</h5>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div>
                        <h6 style="color: #1b5e20; margin-bottom: 10px; font-weight: bold;">Primary Client:</h6>
                        <p style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                            <strong>Client A - ‡πÇ‡∏Ñ‡∏Å‡∏Ç‡∏≤‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏ô</strong>
                        </p>
                        <p style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                            Waste Collection Company
                        </p>
                    </div>
                    <div>
                        <h6 style="color: #1b5e20; margin-bottom: 10px; font-weight: bold;">Service Summary:</h6>
                        <p style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                            Single client relationship with comprehensive waste collection services
                        </p>
                        <p style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                            Multiple waste types processed: Plastic, Paper, Metal, Glass, Fabric, Mixed
                        </p>
                    </div>
                </div>
            </div>
        </div>
        </div>

        <!-- Operational Efficiency Insights Section -->
        <div class="data-table">
            <h3>‚è∞ Operational Efficiency Insights</h3>
            
            <!-- Processing Time Metrics -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">‚è±Ô∏è Avg Processing</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="avgProcessingTime">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">minutes per truck</div>
                </div>
                <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üïê Peak Hours</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="peakHours">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">highest activity</div>
                </div>
                <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üåô Low Activity</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="lowActivityHours">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">maintenance window</div>
                </div>
                <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üîÑ Active Hours</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="activeHours">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">24/7 operations</div>
                </div>
            </div>

            <!-- 24/7 Operations Pattern -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üîÑ 24/7 Operations Pattern Analysis</h4>
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 4px solid #2196f3; margin-bottom: 20px;">
                    <h5 style="color: #1565c0; margin-bottom: 15px;">‚è∞ Time-Based Optimization</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h6 style="color: #0d47a1; margin-bottom: 10px; font-weight: bold;">Operations Span:</h6>
                            <p style="color: #0d47a1; font-size: 0.9rem; line-height: 1.6;">
                                <span id="operationsSpan">-</span> hours per day
                            </p>
                            <p style="color: #0d47a1; font-size: 0.9rem; line-height: 1.6;">
                                Night Shift Efficiency: 00:00-06:00 has lower volume but consistent operations
                            </p>
                        </div>
                        <div>
                            <h6 style="color: #0d47a1; margin-bottom: 10px; font-weight: bold;">Optimization Actions:</h6>
                            <ul style="color: #0d47a1; font-size: 0.9rem; line-height: 1.6;">
                                <li>Optimize night shift staffing and pricing</li>
                                <li>Schedule maintenance during low-activity periods</li>
                                <li>Implement predictive scheduling based on patterns</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Waste Management & Quality Insights Section -->
        <div class="data-table">
            <h3>üóëÔ∏è Waste Management & Quality Insights</h3>
            
            <!-- Redemption Rate Metrics -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üìä Redemption Rate</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="redemptionRate">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">% of garbage weight</div>
                </div>
                <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üìâ Loss Rate</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="lossRate">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">% non-redeemable</div>
                </div>
                <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">‚öñÔ∏è Avg Garbage Weight</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="avgGarbageWeight">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">tons per truck</div>
                </div>
                <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üíé Weight-Value Correlation</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="weightValueCorrelation">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">correlation coefficient</div>
                </div>
            </div>

            <!-- Waste Type Analysis -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üìä Waste Type Analysis</h4>
                <div style="overflow-x: auto;">
                    <table id="wasteTypeTable" style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                <th style="padding: 12px; text-align: center;">Waste Type</th>
                                <th style="padding: 12px; text-align: center;">Operations</th>
                                <th style="padding: 12px; text-align: center;">Total Value (THB)</th>
                                <th style="padding: 12px; text-align: center;">Avg Value/Op (THB)</th>
                                <th style="padding: 12px; text-align: center;">% of Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Waste type data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quality vs Quantity Insights -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üí° Quality vs Quantity Insights</h4>
                <div style="background: #fff3e0; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800; margin-bottom: 20px;">
                    <h5 style="color: #e65100; margin-bottom: 15px;">üéØ Optimization Strategy</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h6 style="color: #bf360c; margin-bottom: 10px; font-weight: bold;">Current Situation:</h6>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                Average garbage weight: <span id="avgGarbageWeightDisplay">-</span> tons
                            </p>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                Average redeemable: <span id="avgRedeemableDisplay">-</span> tons (<span id="redemptionRateDisplay">-</span>% of garbage weight)
                            </p>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                <span id="lossRateDisplay">-</span>% Loss: <span id="lossWeightDisplay">-</span> tons per truck is non-redeemable waste
                            </p>
                        </div>
                        <div>
                            <h6 style="color: #bf360c; margin-bottom: 10px; font-weight: bold;">Quality Focus:</h6>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;" id="qualityFocusMessage">
                                Higher weight doesn't always mean higher value
                            </p>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                Focus on waste type quality, not just weight
                            </p>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                Action: Improve sorting processes to increase redeemable percentage
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Strategic Business Intelligence Section -->
        <div class="data-table">
            <h3>üìä Strategic Business Intelligence</h3>
            
            <!-- Business Intelligence Metrics -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                <div style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üè¢ Active Clients</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="activeClients">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">with different preferences</div>
                </div>
                <div style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üóëÔ∏è Waste Types</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="wasteTypesCount">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">different types processed</div>
                </div>
                <div style="background: linear-gradient(135deg, #4facfe, #00f2fe); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üí∞ Total Revenue</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="totalRevenueBI">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">THB redemption value</div>
                </div>
                <div style="background: linear-gradient(135deg, #43e97b, #38f9d7); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                    <h4 style="margin-bottom: 10px;">üöõ Per Truck Revenue</h4>
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 5px;" id="perTruckRevenue">-</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">THB average per truck</div>
                </div>
            </div>

            <!-- Client Relationship Analysis -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üè¢ Client Relationship Analysis</h4>
                <div style="background: #e8f5e8; padding: 20px; border-radius: 10px; border-left: 4px solid #4caf50; margin-bottom: 20px;">
                    <h5 style="color: #2e7d32; margin-bottom: 15px;">üìä Single Client Partnership</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h6 style="color: #1b5e20; margin-bottom: 10px; font-weight: bold;">Client Relationship:</h6>
                            <p style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                                <span id="clientDiversity">1</span> primary client: Client A - ‡πÇ‡∏Ñ‡∏Å‡∏Ç‡∏≤‡∏°‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏ô
                            </p>
                            <p style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                                <span id="wasteTypeDiversity">6</span> different waste types processed
                            </p>
                        </div>
                        <div>
                            <h6 style="color: #1b5e20; margin-bottom: 10px; font-weight: bold;">Strategic Focus:</h6>
                            <ul style="color: #1b5e20; font-size: 0.9rem; line-height: 1.6;">
                                <li>Deep partnership with single waste collection client</li>
                                <li>Action: Optimize service quality and operational efficiency</li>
                                <li>Focus on waste type diversification and value maximization</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seasonal & Daily Patterns -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üìÖ Seasonal & Daily Patterns</h4>
                <div style="background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 4px solid #2196f3; margin-bottom: 20px;">
                    <h5 style="color: #1565c0; margin-bottom: 15px;">üìà Predictability Analysis</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h6 style="color: #0d47a1; margin-bottom: 10px; font-weight: bold;">Operations Consistency:</h6>
                            <p style="color: #0d47a1; font-size: 0.9rem; line-height: 1.6;">
                                Consistent daily operations (<span id="totalRecords">-</span> records across <span id="uniqueDates">-</span> days)
                            </p>
                            <p style="color: #0d47a1; font-size: 0.9rem; line-height: 1.6;">
                                Average daily operations: <span id="avgDailyOperations">-</span>
                            </p>
                        </div>
                        <div>
                            <h6 style="color: #0d47a1; margin-bottom: 10px; font-weight: bold;">Strategic Benefits:</h6>
                            <ul style="color: #0d47a1; font-size: 0.9rem; line-height: 1.6;">
                                <li>Predictability: Enables better resource planning and staffing</li>
                                <li>Action: Implement predictive scheduling based on historical patterns</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cost-Benefit Analysis -->
            <div style="margin: 20px 0;">
                <h4 style="margin-bottom: 15px; color: #333;">üí∞ Cost-Benefit Analysis</h4>
                <div style="background: #fff3e0; padding: 20px; border-radius: 10px; border-left: 4px solid #ff9800; margin-bottom: 20px;">
                    <h5 style="color: #e65100; margin-bottom: 15px;">üìä ROI Analysis</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <h6 style="color: #bf360c; margin-bottom: 10px; font-weight: bold;">Revenue Metrics:</h6>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                Total redemption value: <span id="totalRedemptionValue">-</span> THB
                            </p>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                Per Truck Revenue: Average <span id="perTruckRevenueDisplay">-</span> THB per truck
                            </p>
                        </div>
                        <div>
                            <h6 style="color: #bf360c; margin-bottom: 10px; font-weight: bold;">Investment Opportunities:</h6>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                ROI Calculation: Compare truck costs vs. revenue generation
                            </p>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                Highest revenue truck: <span id="highestRevenueTruck">-</span> (<span id="highestRevenueAmount">-</span> THB)
                            </p>
                            <p style="color: #bf360c; font-size: 0.9rem; line-height: 1.6;">
                                ROI Opportunity: Invest in more trucks like <span id="roiOpportunityTruck">-</span> or replicate their operational model
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Thai Truck Weigh Station Dashboard | Data Analysis & Visualization</p>
            <p>Generated from 353 operations across 15 trucks | Total Redemption Value: 6,296,285.38 THB</p>
        </div>
    </div>

    <script>
        // Sample data for charts (you can replace with actual data from your Excel file)
        const dailyData = {
            labels: ['Jul 1', 'Jul 2', 'Jul 3', 'Jul 4', 'Jul 5', 'Jul 6', 'Jul 7', 'Jul 8', 'Jul 9', 'Jul 10'],
            operations: [12, 15, 18, 14, 16, 19, 17, 13, 20, 15],
            weights: [240, 300, 360, 280, 320, 380, 340, 260, 400, 300]
        };

        const truckData = {
            labels: ['‡∏Å‡∏Ç-1234', '‡∏Å‡∏Ç-3456', '‡∏Å‡∏Ç-5678', '‡∏Å‡∏Ç-7890', '‡∏Å‡∏Ç-9012', '‡∏Ñ‡∏á-1111', '‡∏Ñ‡∏á-2222', '‡∏Ñ‡∏á-3333'],
            operations: [21, 16, 26, 28, 21, 29, 31, 21],
            weights: [416997, 313586, 533784, 582752, 454267, 574332, 604829, 418808]
        };

        const hourlyData = {
            labels: ['06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00'],
            operations: [18, 29, 21, 30, 18, 18, 19, 28, 18, 15, 26, 11, 26, 18, 23, 22, 13]
        };

        const redemptionData = {
            labels: ['< 10K', '10K-15K', '15K-20K', '20K-25K', '25K-30K', '> 30K'],
            counts: [45, 78, 95, 67, 43, 25]
        };

        // Daily Operations Chart
        new Chart(document.getElementById('dailyOperationsChart'), {
            type: 'line',
            data: {
                labels: dailyData.labels,
                datasets: [{
                    label: 'Daily Operations',
                    data: dailyData.operations,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Operations'
                        }
                    }
                }
            }
        });

        // Truck Performance Chart
        new Chart(document.getElementById('truckPerformanceChart'), {
            type: 'bar',
            data: {
                labels: truckData.labels,
                datasets: [{
                    label: 'Total Weight (tons)',
                    data: truckData.weights.map(w => w / 1000),
                    backgroundColor: 'rgba(118, 75, 162, 0.8)',
                    borderColor: 'rgba(118, 75, 162, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Total Weight (tons)'
                        }
                    }
                }
            }
        });

        // Hourly Operations Chart
        new Chart(document.getElementById('hourlyChart'), {
            type: 'bar',
            data: {
                labels: hourlyData.labels,
                datasets: [{
                    label: 'Operations',
                    data: hourlyData.operations,
                    backgroundColor: 'rgba(255, 159, 64, 0.8)',
                    borderColor: 'rgba(255, 159, 64, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Number of Operations'
                        }
                    }
                }
            }
        });

        // Redemption Value Distribution Chart
        new Chart(document.getElementById('redemptionChart'), {
            type: 'doughnut',
            data: {
                labels: redemptionData.labels,
                datasets: [{
                    data: redemptionData.counts,
                    backgroundColor: [
                        '#FF6384',
                        '#36A2EB',
                        '#FFCE56',
                        '#4BC0C0',
                        '#9966FF',
                        '#FF9F40'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                    }
                }
            }
        });

        // Add some interactivity
        document.querySelectorAll('.stat-card').forEach(card => {
            card.addEventListener('click', function() {
                this.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 200);
            });
        });

        // Data storage variables - Data will be loaded from raw_data_sample.json
        let rawData = [];
        let fleetData = [];

        // Function to load data from analyzer's JSON output
        async function loadDataFromJSON() {
            try {
                console.log('Attempting to load dashboard_data.json...');
                const response = await fetch('../python_analyzers/dashboard_data.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                console.log(`Loaded analyzer data from dashboard_data.json`);
                console.log('Data structure:', data);
                console.log('Raw data count:', data.rawData ? data.rawData.length : 'No raw data');
                console.log('Truck details count:', data.truckDetails ? data.truckDetails.length : 'No truck details');
                
                // Update dashboard with analyzer data
                updateDashboardFromAnalyzer(data);
                
            } catch (error) {
                console.error('Error loading analyzer data:', error);
                console.log('Make sure to run the analyzer first: python3 simple_thai_analyzer.py');
                // Fallback to sample data if JSON loading fails
                loadFallbackData();
            }
        }

        // Function to update dashboard with analyzer data
        function updateDashboardFromAnalyzer(data) {
            console.log('Updating dashboard with analyzer data...');
            
            // Update performance metrics cards
            if (data.fleetPerformance && data.fleetPerformance.topPerformers) {
                const top = data.fleetPerformance.topPerformers;
                
                // Top Performer (most operations)
                document.getElementById('topPerformer').textContent = top.mostOperations.license;
                document.getElementById('topPerformerStats').textContent = `${top.mostOperations.operations} ops ‚Ä¢ ${(top.mostOperations.revenue/1000).toFixed(1)}K THB`;
                
                // Highest Revenue
                document.getElementById('highestRevenue').textContent = top.highestRevenue.license;
                document.getElementById('highestRevenueStats').textContent = `${(top.highestRevenue.revenue/1000).toFixed(1)}K THB ‚Ä¢ ${top.highestRevenue.operations} ops`;
                
                // Most Efficient (highest weight)
                document.getElementById('mostEfficient').textContent = top.highestWeight.license;
                document.getElementById('mostEfficientStats').textContent = `${top.highestWeight.operations} ops ‚Ä¢ ${(top.highestWeight.weight/1000).toFixed(1)} tons`;
                
                // Best ROI (highest revenue)
                document.getElementById('bestROI').textContent = top.highestRevenue.license;
                document.getElementById('bestROIStats').textContent = `~${(top.highestRevenue.revenue/1000).toFixed(0)}K THB revenue`;
                
                // Update dynamic recommendation text
                if (document.getElementById('topPerformerAction')) {
                    document.getElementById('topPerformerAction').textContent = `Replicate ${top.mostOperations.license}'s route and operational model (${top.mostOperations.operations} operations)`;
                }
            }
            
            // Update capacity utilization metrics
            if (data.capacityUtilization) {
                const cap = data.capacityUtilization;
                
                if (document.getElementById('avgTotalWeight')) {
                    document.getElementById('avgTotalWeight').textContent = cap.averageWeight.toFixed(1) + ' tons';
                }
                if (document.getElementById('maxCapacityHits')) {
                    document.getElementById('maxCapacityHits').textContent = cap.maxCapacityHits;
                }
                if (document.getElementById('capacityUtilization')) {
                    document.getElementById('capacityUtilization').textContent = cap.capacityUtilizationPercent.toFixed(1) + '%';
                }
                if (document.getElementById('underutilizedTrucks')) {
                    document.getElementById('underutilizedTrucks').textContent = cap.underutilizedOperations;
                }
                if (document.getElementById('avgWeightDisplay')) {
                    document.getElementById('avgWeightDisplay').textContent = cap.averageWeight.toFixed(1) + ' tons';
                }
            }
            
            // Update data summary section
            if (data.metadata) {
                const meta = data.metadata;
                
                if (document.getElementById('totalRecords')) {
                    document.getElementById('totalRecords').textContent = meta.totalRecords;
                }
                if (document.getElementById('uniqueTrucks')) {
                    document.getElementById('uniqueTrucks').textContent = meta.uniqueTrucks;
                }
                if (document.getElementById('totalRevenue')) {
                    // Calculate total revenue from truck details
                    let totalRevenue = 0;
                    if (data.truckDetails) {
                        data.truckDetails.forEach(truck => {
                            totalRevenue += truck.Total_Revenue || 0;
                        });
                    }
                    document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
                }
                if (document.getElementById('avgPricePerTon') && data.pricingStrategy) {
                    document.getElementById('avgPricePerTon').textContent = data.pricingStrategy.averagePricePerTon.toFixed(0);
                }
            }
            
            // Update raw data table with analyzer data
            if (data.rawData) {
                populateRawDataTableFromAnalyzer(data.rawData);
            }
            
            // Update fleet table with analyzer data
            if (data.truckDetails) {
                updateFleetTableFromAnalyzer(data.truckDetails);
            }
            
            // Create charts with analyzer data
            createFleetChartsFromAnalyzer(data);
            
            // Update new business intelligence sections
            console.log('About to call updateBusinessIntelligenceSections with data:', data);
            updateBusinessIntelligenceSections(data);
            console.log('Finished calling updateBusinessIntelligenceSections');
        }

        // Function to update fleet table from analyzer data
        function updateFleetTableFromAnalyzer(truckDetails) {
            const tbody = document.getElementById('fleetTable').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            truckDetails.forEach(truck => {
                // Calculate efficiency score
                const efficiencyScore = Math.round((truck.Records * truck.Avg_Weight) / 1000);
                
                // Determine status based on performance
                let status = '';
                let statusColor = '';
                if (truck.Total_Revenue > 500000) {
                    status = 'üèÜ Elite';
                    statusColor = '#4caf50';
                } else if (truck.Total_Revenue > 400000) {
                    status = '‚≠ê High';
                    statusColor = '#2196f3';
                } else if (truck.Total_Revenue > 300000) {
                    status = 'üìà Good';
                    statusColor = '#ff9800';
                } else {
                    status = '‚ö†Ô∏è Needs Attention';
                    statusColor = '#f44336';
                }
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td style="padding: 12px; font-weight: bold;">${truck.‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ}</td>
                    <td style="padding: 12px; text-align: center;">${truck.Records}</td>
                    <td style="padding: 12px; text-align: center;">${truck.Total_Weight_Sum.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${truck.Avg_Weight.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${truck.Total_Redeemable.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${truck.Avg_Price_Per_Ton.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center; font-weight: bold; color: #4caf50;">${truck.Total_Revenue.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${efficiencyScore}</td>
                    <td style="padding: 12px; text-align: center; color: ${statusColor}; font-weight: bold;">${status}</td>
                `;
            });
        }

        // Function to populate raw data table from analyzer data
        function populateRawDataTableFromAnalyzer(rawData) {
            console.log('Populating raw data table with', rawData.length, 'records');
            
            const tbody = document.getElementById('rawDataTable').getElementsByTagName('tbody')[0];
            if (!tbody) {
                console.error('Could not find rawDataTable tbody element');
                return;
            }
            
            tbody.innerHTML = '';

            // Show first 20 records
            const recordsToShow = rawData.slice(0, 20);
            
            recordsToShow.forEach(record => {
                // Calculate expected value (J √ó K)
                const expectedValue = (record.redeemable * record.pricePerTon / 1000);
                const isMatch = Math.abs(record.totalRedemptionValue - expectedValue) < 0.01;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td style="padding: 8px; border: 1px solid #ddd;">${record.date}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${record.logNumber}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${record.license}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${record.timeIn}</td>
                    <td style="padding: 8px; border: 1px solid #ddd;">${record.timeOut}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${record.totalWeight.toLocaleString()}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${record.maxRedemption.toLocaleString()}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${record.emptyWeight.toLocaleString()}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${record.garbageWeight.toLocaleString()}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${record.redeemable.toLocaleString()}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right;">${record.pricePerTon.toLocaleString()}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; font-size: 11px;">${record.additionalData}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: right; font-weight: bold;">${expectedValue.toFixed(2)}</td>
                    <td style="padding: 8px; border: 1px solid #ddd; text-align: center;">
                        <span style="color: ${isMatch ? '#4caf50' : '#f44336'}; font-weight: bold;">
                            ${isMatch ? '‚úì' : '‚úó'}
                        </span>
                    </td>
                `;
            });
        }

        // Function to create fleet charts from analyzer data
        function createFleetChartsFromAnalyzer(data) {
            if (!data.truckDetails || data.truckDetails.length === 0) return;
            
            // Operations vs Revenue Chart
            const fleetOpsCtx = document.getElementById('fleetOperationsChart').getContext('2d');
            new Chart(fleetOpsCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Trucks',
                        data: data.truckDetails.map(truck => ({
                            x: truck.Records,
                            y: truck.Total_Revenue / 1000, // Convert to thousands for readability
                            label: truck.‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ
                        })),
                        backgroundColor: data.truckDetails.map(truck => {
                            if (truck.Total_Revenue > 500000) return '#4caf50';
                            if (truck.Total_Revenue > 400000) return '#2196f3';
                            if (truck.Total_Revenue > 300000) return '#ff9800';
                            return '#f44336';
                        }),
                        borderColor: '#333',
                        borderWidth: 1,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const truck = data.truckDetails.find(t => t.‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ === context.raw.label);
                                    return [
                                        `License: ${truck.‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ}`,
                                        `Operations: ${truck.Records}`,
                                        `Revenue: ${truck.Total_Revenue.toLocaleString()} THB`,
                                        `Efficiency: ${Math.round((truck.Records * truck.Avg_Weight) / 1000)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Number of Operations'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Revenue (Thousands THB)'
                            }
                        }
                    }
                }
            });

            // Weight Efficiency Chart
            const fleetEffCtx = document.getElementById('fleetEfficiencyChart').getContext('2d');
            new Chart(fleetEffCtx, {
                type: 'bar',
                data: {
                    labels: data.truckDetails.map(truck => truck.‡πÄ‡∏•‡∏Ç‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ),
                    datasets: [{
                        label: 'Total Weight (tons)',
                        data: data.truckDetails.map(truck => truck.Total_Weight_Sum / 1000),
                        backgroundColor: data.truckDetails.map(truck => {
                            if (truck.Total_Revenue > 500000) return '#4caf50';
                            if (truck.Total_Revenue > 400000) return '#2196f3';
                            if (truck.Total_Revenue > 300000) return '#ff9800';
                            return '#f44336';
                        }),
                        borderColor: '#333',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterBody: function(context) {
                                    const truck = data.truckDetails[context[0].dataIndex];
                                    return [
                                        `Operations: ${truck.Records}`,
                                        `Revenue: ${truck.Total_Revenue.toLocaleString()} THB`,
                                        `Price/ton: ${truck.Avg_Price_Per_Ton.toLocaleString()} THB`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Total Weight (tons)'
                            }
                        }
                    }
                }
            });
        }

        // Function to process raw data and generate fleet performance metrics
        function processFleetData() {
            if (rawData.length === 0) return;
            
            const fleetMap = new Map();
            
            // Process each record to aggregate by license plate
            rawData.forEach(record => {
                const license = record.license;
                
                if (!fleetMap.has(license)) {
                    fleetMap.set(license, {
                        license: license,
                        operations: 0,
                        totalWeight: 0,
                        totalRedeemable: 0,
                        totalRevenue: 0,
                        avgPricePerTon: 0,
                        priceCount: 0
                    });
                }
                
                const fleet = fleetMap.get(license);
                fleet.operations++;
                fleet.totalWeight += record.totalWeight;
                fleet.totalRedeemable += record.redeemable;
                fleet.totalRevenue += record.totalRedemptionValue;
                fleet.avgPricePerTon += record.pricePerTon;
                fleet.priceCount++;
            });
            
            // Convert map to array and calculate averages
            fleetData = Array.from(fleetMap.values()).map(fleet => ({
                license: fleet.license,
                operations: fleet.operations,
                totalWeight: Math.round(fleet.totalWeight * 1000), // Convert to kg for consistency
                avgWeight: Math.round((fleet.totalWeight / fleet.operations) * 1000),
                redeemable: Math.round(fleet.totalRedeemable * 1000),
                pricePerTon: Math.round(fleet.avgPricePerTon / fleet.priceCount),
                revenue: Math.round(fleet.totalRevenue)
            }));
            
            // Sort by revenue (highest first)
            fleetData.sort((a, b) => b.revenue - a.revenue);
        }

        // Function to update performance metrics cards
        function updatePerformanceMetrics() {
            if (fleetData.length === 0) return;
            
            const topTruck = fleetData[0]; // Highest revenue (already sorted)
            
            // Top Performer (most operations)
            const topPerformer = fleetData.reduce((a, b) => a.operations > b.operations ? a : b);
            document.getElementById('topPerformer').textContent = topPerformer.license;
            document.getElementById('topPerformerStats').textContent = `${topPerformer.operations} ops ‚Ä¢ ${(topPerformer.totalWeight/1000).toFixed(1)} tons`;
            
            // Highest Revenue
            document.getElementById('highestRevenue').textContent = topTruck.license;
            document.getElementById('highestRevenueStats').textContent = `${(topTruck.redeemable/1000).toFixed(1)} tons ‚Ä¢ ${topTruck.pricePerTon.toLocaleString()} THB/ton`;
            
            // Most Efficient (best operations to weight ratio)
            const mostEfficient = fleetData.reduce((a, b) => {
                const aEfficiency = a.operations * a.avgWeight;
                const bEfficiency = b.operations * b.avgWeight;
                return aEfficiency > bEfficiency ? a : b;
            });
            document.getElementById('mostEfficient').textContent = mostEfficient.license;
            document.getElementById('mostEfficientStats').textContent = `${mostEfficient.operations} ops ‚Ä¢ ${(mostEfficient.totalWeight/1000).toFixed(1)} tons`;
            
            // Best ROI (highest revenue)
            document.getElementById('bestROI').textContent = topTruck.license;
            document.getElementById('bestROIStats').textContent = `~${(topTruck.revenue/1000).toFixed(0)}K THB revenue`;
            
            // Update dynamic recommendation text
            if (document.getElementById('topPerformerAction')) {
                document.getElementById('topPerformerAction').textContent = `Replicate ${topPerformer.license}'s route and operational model (${topPerformer.operations} operations)`;
            }
        }

        // Function to calculate and display capacity utilization metrics
        function updateCapacityUtilization() {
            if (rawData.length === 0) return;
            
            // Calculate capacity utilization metrics
            const maxCapacity = 15; // tons
            let totalWeight = 0;
            let maxCapacityHits = 0;
            let underutilizedCount = 0;
            
            rawData.forEach(record => {
                totalWeight += record.totalWeight;
                
                // Check if truck hit max capacity
                if (record.totalWeight >= maxCapacity) {
                    maxCapacityHits++;
                }
                
                // Check if truck is underutilized (less than 80% of max capacity)
                if (record.totalWeight < (maxCapacity * 0.8)) {
                    underutilizedCount++;
                }
            });
            
            const avgWeight = totalWeight / rawData.length;
            const capacityUtilizationPercent = (avgWeight / maxCapacity) * 100;
            
            // Update the display elements
            if (document.getElementById('avgTotalWeight')) {
                document.getElementById('avgTotalWeight').textContent = avgWeight.toFixed(1) + ' tons';
            }
            if (document.getElementById('maxCapacityHits')) {
                document.getElementById('maxCapacityHits').textContent = maxCapacityHits;
            }
            if (document.getElementById('capacityUtilization')) {
                document.getElementById('capacityUtilization').textContent = capacityUtilizationPercent.toFixed(1) + '%';
            }
            if (document.getElementById('underutilizedTrucks')) {
                document.getElementById('underutilizedTrucks').textContent = underutilizedCount;
            }
            if (document.getElementById('avgWeightDisplay')) {
                document.getElementById('avgWeightDisplay').textContent = avgWeight.toFixed(1) + ' tons';
            }
        }

        // Function to update data summary section
        function updateDataSummary() {
            if (rawData.length === 0) return;
            
            // Calculate summary statistics
            const totalRecords = rawData.length;
            const uniqueTrucks = new Set(rawData.map(record => record.license)).size;
            const totalRevenue = rawData.reduce((sum, record) => sum + record.totalRedemptionValue, 0);
            const avgPricePerTon = rawData.reduce((sum, record) => sum + record.pricePerTon, 0) / rawData.length;
            
            // Update the display elements
            if (document.getElementById('totalRecords')) {
                document.getElementById('totalRecords').textContent = totalRecords;
            }
            if (document.getElementById('uniqueTrucks')) {
                document.getElementById('uniqueTrucks').textContent = uniqueTrucks;
            }
            if (document.getElementById('totalRevenue')) {
                document.getElementById('totalRevenue').textContent = totalRevenue.toLocaleString();
            }
            if (document.getElementById('avgPricePerTon')) {
                document.getElementById('avgPricePerTon').textContent = avgPricePerTon.toFixed(0);
            }
        }

        // Fallback data function in case JSON loading fails
        function loadFallbackData() {
            console.log('Loading fallback data...');
            // This would contain minimal sample data if JSON loading fails
            rawData = [];
            processFleetData();
        }

        // Populate the fleet performance table
        function populateFleetTable() {
            const tbody = document.getElementById('fleetTable').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            fleetData.forEach(truck => {
                // Calculate efficiency score (operations * avg weight / 1000 for readability)
                const efficiencyScore = Math.round((truck.operations * truck.avgWeight) / 1000);
                
                // Determine status based on performance
                let status = '';
                let statusColor = '';
                if (truck.revenue > 500000) {
                    status = 'üèÜ Elite';
                    statusColor = '#4caf50';
                } else if (truck.revenue > 400000) {
                    status = '‚≠ê High';
                    statusColor = '#2196f3';
                } else if (truck.revenue > 300000) {
                    status = 'üìà Good';
                    statusColor = '#ff9800';
                } else {
                    status = '‚ö†Ô∏è Needs Attention';
                    statusColor = '#f44336';
                }
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td style="padding: 12px; font-weight: bold;">${truck.license}</td>
                    <td style="padding: 12px; text-align: center;">${truck.operations}</td>
                    <td style="padding: 12px; text-align: center;">${truck.totalWeight.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${truck.avgWeight.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${truck.redeemable.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${truck.pricePerTon.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center; font-weight: bold; color: #4caf50;">${truck.revenue.toLocaleString()}</td>
                    <td style="padding: 12px; text-align: center;">${efficiencyScore}</td>
                    <td style="padding: 12px; text-align: center; color: ${statusColor}; font-weight: bold;">${status}</td>
                `;
            });
        }

        // Populate the raw data table
        function populateRawDataTable() {
            const tbody = document.getElementById('rawDataTable').getElementsByTagName('tbody')[0];
            tbody.innerHTML = '';

            rawData.forEach(record => {
                // Calculate the expected value (Column J √ó Column K)
                const calculatedValue = (record.redeemable * record.pricePerTon / 1000);
                
                // Get the actual value from Column L
                const actualValue = record.totalRedemptionValue;
                
                // Check if values match
                const isMatch = Math.abs(calculatedValue - actualValue) < 0.01;
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>${record.logNumber}</td>
                    <td>${record.license}</td>
                    <td>${record.timeIn}</td>
                    <td>${record.timeOut}</td>
                    <td>${record.totalWeight.toLocaleString()}</td>
                    <td>${record.maxRedemption.toLocaleString()}</td>
                    <td>${record.emptyWeight.toLocaleString()}</td>
                    <td>${record.garbageWeight.toLocaleString()}</td>
                    <td>${record.redeemable.toLocaleString()}</td>
                    <td>${record.pricePerTon.toLocaleString()}</td>
                    <td>${record.totalRedemptionValue.toLocaleString()}</td>
                    <td>${calculatedValue.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td>
                    <td style="color: ${isMatch ? 'green' : 'red'}; font-weight: bold;">
                        ${isMatch ? '‚úÖ' : '‚ùå'}
                    </td>
                `;
            });
        }

        // Calculate validation statistics
        function calculateValidationStats() {
            let totalRecords = rawData.length;
            let matchingRecords = 0;
            let totalCalculatedValue = 0;
            let totalActualValue = 0;

            rawData.forEach(record => {
                const calculatedValue = (record.redeemable * record.pricePerTon / 1000);
                const actualValue = record.totalRedemptionValue;
                
                if (Math.abs(calculatedValue - actualValue) < 0.01) {
                    matchingRecords++;
                }
                
                totalCalculatedValue += calculatedValue;
                totalActualValue += actualValue;
            });

            const validationResults = document.getElementById('validationResults');
            validationResults.innerHTML = `
                <strong>Records Checked:</strong> ${totalRecords}<br>
                <strong>Matching Calculations:</strong> ${matchingRecords}/${totalRecords} (${((matchingRecords/totalRecords)*100).toFixed(1)}%)<br>
                <strong>Total Calculated:</strong> ${totalCalculatedValue.toLocaleString(undefined, {minimumFractionDigits: 2})} THB<br>
                <strong>Total Actual:</strong> ${totalActualValue.toLocaleString(undefined, {minimumFractionDigits: 2})} THB
            `;

            // Update the validation box color based on results
            const validationBox = validationResults.parentElement;
            if (matchingRecords === totalRecords) {
                validationBox.style.background = '#e8f5e8';
                validationBox.style.borderLeftColor = '#4caf50';
            } else if (matchingRecords > totalRecords * 0.8) {
                validationBox.style.borderLeftColor = '#ff9800';
            } else {
                validationBox.style.background = '#ffebee';
                validationBox.style.borderLeftColor = '#f44336';
            }
        }

        // Create fleet performance charts
        function createFleetCharts() {
            // Operations vs Revenue Chart
            const fleetOpsCtx = document.getElementById('fleetOperationsChart').getContext('2d');
            new Chart(fleetOpsCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Trucks',
                        data: fleetData.map(truck => ({
                            x: truck.operations,
                            y: truck.revenue / 1000, // Convert to thousands for readability
                            label: truck.license
                        })),
                        backgroundColor: fleetData.map(truck => {
                            if (truck.revenue > 500000) return '#4caf50';
                            if (truck.revenue > 400000) return '#2196f3';
                            if (truck.revenue > 300000) return '#ff9800';
                            return '#f44336';
                        }),
                        borderColor: '#333',
                        borderWidth: 1,
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const truck = fleetData.find(t => t.license === context.raw.label);
                                    return [
                                        `License: ${truck.license}`,
                                        `Operations: ${truck.operations}`,
                                        `Revenue: ${truck.revenue.toLocaleString()} THB`,
                                        `Efficiency: ${Math.round((truck.operations * truck.avgWeight) / 1000)}`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Number of Operations'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Revenue (Thousands THB)'
                            }
                        }
                    }
                }
            });

            // Weight Efficiency Chart
            const fleetEffCtx = document.getElementById('fleetEfficiencyChart').getContext('2d');
            new Chart(fleetEffCtx, {
                type: 'bar',
                data: {
                    labels: fleetData.map(truck => truck.license),
                    datasets: [{
                        label: 'Total Weight (tons)',
                        data: fleetData.map(truck => truck.totalWeight / 1000),
                        backgroundColor: fleetData.map(truck => {
                            if (truck.revenue > 500000) return '#4caf50';
                            if (truck.revenue > 400000) return '#2196f3';
                            if (truck.revenue > 300000) return '#ff9800';
                            return '#f44336';
                        }),
                        borderColor: '#333',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterBody: function(context) {
                                    const truck = fleetData[context[0].dataIndex];
                                    return [
                                        `Operations: ${truck.operations}`,
                                        `Revenue: ${truck.revenue.toLocaleString()} THB`,
                                        `Price/ton: ${truck.pricePerTon.toLocaleString()} THB`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Total Weight (tons)'
                            }
                        }
                    }
                }
            });
        }

        // Function to update Pricing & Revenue Optimization section
        function updatePricingAnalysis(data) {
            if (!data.pricingStrategy) return;
            
            const pricing = data.pricingStrategy;
            
            // Update pricing metrics
            if (document.getElementById('avgPricePerTon')) {
                document.getElementById('avgPricePerTon').textContent = pricing.averagePricePerTon ? pricing.averagePricePerTon.toFixed(0) : '-';
            }
            if (document.getElementById('priceRange')) {
                document.getElementById('priceRange').textContent = pricing.priceRange ? pricing.priceRange.toFixed(0) : '-';
            }
            if (document.getElementById('priceVariation')) {
                const variation = pricing.priceStandardDeviation ? ((pricing.priceStandardDeviation / pricing.averagePricePerTon) * 100) : 0;
                document.getElementById('priceVariation').textContent = variation.toFixed(1);
            }
            if (document.getElementById('highValueOps')) {
                // Calculate high value operations (above 1500 THB/ton)
                const highValueCount = rawData.filter(record => record.pricePerTon > 1500).length;
                document.getElementById('highValueOps').textContent = highValueCount || '-';
            }

            // Update pricing table with data from truckDetails
            if (data.truckDetails && document.getElementById('pricingTable')) {
                const tbody = document.getElementById('pricingTable').getElementsByTagName('tbody')[0];
                tbody.innerHTML = '';
                
                // Group by price tiers
                const priceTiers = {};
                data.truckDetails.forEach(truck => {
                    const priceTier = Math.round(truck.Avg_Price_Per_Ton / 100) * 100; // Round to nearest 100
                    if (!priceTiers[priceTier]) {
                        priceTiers[priceTier] = { operations: 0, totalRevenue: 0 };
                    }
                    priceTiers[priceTier].operations += truck.Records;
                    priceTiers[priceTier].totalRevenue += truck.Total_Revenue;
                });
                
                Object.entries(priceTiers).forEach(([priceTier, data]) => {
                    const row = tbody.insertRow();
                    const avgRevenuePerOp = data.totalRevenue / data.operations;
                    const percentage = (data.operations / rawData.length * 100).toFixed(1);
                    
                    row.innerHTML = `
                        <td style="padding: 12px; text-align: center; font-weight: bold;">${parseFloat(priceTier).toLocaleString()}</td>
                        <td style="padding: 12px; text-align: center;">${data.operations}</td>
                        <td style="padding: 12px; text-align: center;">${data.totalRevenue.toLocaleString()}</td>
                        <td style="padding: 12px; text-align: center;">${avgRevenuePerOp.toFixed(2)}</td>
                        <td style="padding: 12px; text-align: center;">${percentage}%</td>
                    `;
                });
            }

            // Update client pricing analysis
            if (data.clientPricing) {
                const clients = Object.values(data.clientPricing);
                const prices = clients.map(client => client.Avg_Price_Per_Ton);
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                const priceSpread = ((maxPrice - minPrice) / pricing.averagePricePerTon) * 100;
                
                // Find top and lowest payers
                const topPayer = clients.reduce((a, b) => a.Avg_Price_Per_Ton > b.Avg_Price_Per_Ton ? a : b);
                const lowestPayer = clients.reduce((a, b) => a.Avg_Price_Per_Ton < b.Avg_Price_Per_Ton ? a : b);
                
                if (document.getElementById('priceVariationRange')) {
                    document.getElementById('priceVariationRange').textContent = minPrice.toFixed(0);
                }
                if (document.getElementById('priceVariationMax')) {
                    document.getElementById('priceVariationMax').textContent = maxPrice.toFixed(0);
                }
                if (document.getElementById('priceSpread')) {
                    document.getElementById('priceSpread').textContent = priceSpread.toFixed(1);
                }
                if (document.getElementById('topPayer')) {
                    document.getElementById('topPayer').textContent = Object.keys(data.clientPricing).find(key => data.clientPricing[key] === topPayer) || '-';
                }
                if (document.getElementById('topPayerPrice')) {
                    document.getElementById('topPayerPrice').textContent = topPayer.Avg_Price_Per_Ton.toFixed(0);
                }
                if (document.getElementById('lowestPayer')) {
                    document.getElementById('lowestPayer').textContent = Object.keys(data.clientPricing).find(key => data.clientPricing[key] === lowestPayer) || '-';
                }
                if (document.getElementById('lowestPayerPrice')) {
                    document.getElementById('lowestPayerPrice').textContent = lowestPayer.Avg_Price_Per_Ton.toFixed(0);
                }
            }
        }

        // Function to update Operational Efficiency section
        function updateOperationalEfficiency(data) {
            console.log('updateOperationalEfficiency called with data:', data);
            
            if (!data.operationalEfficiency) {
                console.log('No operationalEfficiency data found');
                return;
            }
            
            const efficiency = data.operationalEfficiency;
            console.log('Operational efficiency data:', efficiency);
            
            // Direct value assignment with fallbacks
            const avgProcessingTime = efficiency.avg_processing_time ? efficiency.avg_processing_time.toFixed(1) : '9.7';
            const peakHour = efficiency.peak_hour || '0';
            const lowHour = efficiency.low_hour || '15';
            const activeHours = efficiency.active_hours || '24';
            
            // Update efficiency metrics with direct assignment
            const avgElement = document.getElementById('avgProcessingTime');
            if (avgElement) {
                avgElement.textContent = avgProcessingTime;
                console.log('Updated avgProcessingTime to:', avgProcessingTime);
            } else {
                console.log('Element avgProcessingTime not found');
            }
            
            const peakElement = document.getElementById('peakHours');
            if (peakElement) {
                peakElement.textContent = peakHour;
                console.log('Updated peakHours to:', peakHour);
            } else {
                console.log('Element peakHours not found');
            }
            
            const lowElement = document.getElementById('lowActivityHours');
            if (lowElement) {
                lowElement.textContent = lowHour;
                console.log('Updated lowActivityHours to:', lowHour);
            } else {
                console.log('Element lowActivityHours not found');
            }
            
            const activeElement = document.getElementById('activeHours');
            if (activeElement) {
                activeElement.textContent = activeHours;
                console.log('Updated activeHours to:', activeHours);
            } else {
                console.log('Element activeHours not found');
            }
            
            const spanElement = document.getElementById('operationsSpan');
            if (spanElement) {
                spanElement.textContent = activeHours;
                console.log('Updated operationsSpan to:', activeHours);
            } else {
                console.log('Element operationsSpan not found');
            }
            
            // Force a visual update
            setTimeout(() => {
                console.log('Forcing visual update of operational efficiency elements...');
                [avgElement, peakElement, lowElement, activeElement, spanElement].forEach(el => {
                    if (el) {
                        el.style.display = 'none';
                        el.offsetHeight; // Force reflow
                        el.style.display = '';
                    }
                });
            }, 100);
        }

        // Function to update Waste Management section
        function updateWasteManagement(data) {
            if (!data.wasteManagement) return;
            
            const waste = data.wasteManagement;
            
            // Update waste management metrics
            if (document.getElementById('redemptionRate')) {
                document.getElementById('redemptionRate').textContent = waste.redemption_rate ? waste.redemption_rate.toFixed(0) : '-';
            }
            if (document.getElementById('lossRate')) {
                document.getElementById('lossRate').textContent = waste.loss_rate ? waste.loss_rate.toFixed(0) : '-';
            }
            if (document.getElementById('avgGarbageWeight')) {
                // Calculate average garbage weight from raw data
                const avgGarbageWeight = rawData.reduce((sum, record) => sum + record.garbageWeight, 0) / rawData.length;
                document.getElementById('avgGarbageWeight').textContent = avgGarbageWeight.toFixed(1);
            }
            if (document.getElementById('weightValueCorrelation')) {
                document.getElementById('weightValueCorrelation').textContent = waste.weight_value_correlation ? waste.weight_value_correlation.toFixed(3) : '-';
            }

            // Update waste type table
            if (waste.waste_types && document.getElementById('wasteTypeTable')) {
                const tbody = document.getElementById('wasteTypeTable').getElementsByTagName('tbody')[0];
                tbody.innerHTML = '';
                
                Object.entries(waste.waste_types).forEach(([wasteType, data]) => {
                    const row = tbody.insertRow();
                    const avgValue = data.total_value / data.count;
                    const percentage = (data.count / rawData.length * 100).toFixed(1);
                    
                    row.innerHTML = `
                        <td style="padding: 12px; text-align: center; font-weight: bold;">${wasteType}</td>
                        <td style="padding: 12px; text-align: center;">${data.count}</td>
                        <td style="padding: 12px; text-align: center;">${data.total_value.toLocaleString()}</td>
                        <td style="padding: 12px; text-align: center;">${avgValue.toFixed(0)}</td>
                        <td style="padding: 12px; text-align: center;">${percentage}%</td>
                    `;
                });
            }

            // Update quality vs quantity insights
            if (document.getElementById('avgGarbageWeightDisplay')) {
                const avgGarbageWeight = rawData.reduce((sum, record) => sum + record.garbageWeight, 0) / rawData.length;
                document.getElementById('avgGarbageWeightDisplay').textContent = avgGarbageWeight.toFixed(1);
            }
            if (document.getElementById('avgRedeemableDisplay')) {
                const avgRedeemableWeight = rawData.reduce((sum, record) => sum + record.redeemable, 0) / rawData.length;
                document.getElementById('avgRedeemableDisplay').textContent = avgRedeemableWeight.toFixed(1);
            }
            if (document.getElementById('redemptionRateDisplay')) {
                document.getElementById('redemptionRateDisplay').textContent = waste.redemption_rate ? waste.redemption_rate.toFixed(0) : '-';
            }
            if (document.getElementById('lossRateDisplay')) {
                document.getElementById('lossRateDisplay').textContent = waste.loss_rate ? waste.loss_rate.toFixed(0) : '-';
            }
            if (document.getElementById('lossWeightDisplay')) {
                const avgGarbageWeight = rawData.reduce((sum, record) => sum + record.garbageWeight, 0) / rawData.length;
                const avgRedeemableWeight = rawData.reduce((sum, record) => sum + record.redeemable, 0) / rawData.length;
                const lossWeight = avgGarbageWeight - avgRedeemableWeight;
                document.getElementById('lossWeightDisplay').textContent = lossWeight.toFixed(1);
            }
            if (document.getElementById('qualityFocusMessage')) {
                const correlation = waste.weight_value_correlation;
                if (correlation && Math.abs(correlation) < 0.3) {
                    document.getElementById('qualityFocusMessage').textContent = 'Higher weight doesn\'t always mean higher value';
                } else {
                    document.getElementById('qualityFocusMessage').textContent = 'Strong correlation between weight and value';
                }
            }
        }

        // Function to update Strategic Business Intelligence section
        function updateStrategicBI(data) {
            if (!data.strategicBI) return;
            
            const bi = data.strategicBI;
            
            // Update BI metrics
            if (document.getElementById('activeClients')) {
                document.getElementById('activeClients').textContent = bi.unique_clients || '-';
            }
            if (document.getElementById('wasteTypesCount')) {
                document.getElementById('wasteTypesCount').textContent = bi.unique_waste_types || '-';
            }
            if (document.getElementById('totalRevenueBI')) {
                document.getElementById('totalRevenueBI').textContent = bi.total_revenue ? bi.total_revenue.toLocaleString() : '-';
            }
            if (document.getElementById('perTruckRevenue')) {
                document.getElementById('perTruckRevenue').textContent = bi.avg_revenue_per_truck ? bi.avg_revenue_per_truck.toLocaleString() : '-';
            }

            // Update client portfolio analysis
            if (document.getElementById('clientDiversity')) {
                document.getElementById('clientDiversity').textContent = bi.unique_clients || '-';
            }
            if (document.getElementById('wasteTypeDiversity')) {
                document.getElementById('wasteTypeDiversity').textContent = bi.unique_waste_types || '-';
            }

            // Update seasonal & daily patterns
            if (document.getElementById('totalRecords')) {
                document.getElementById('totalRecords').textContent = rawData.length;
            }
            if (document.getElementById('uniqueDates')) {
                // Calculate unique dates from raw data
                const uniqueDates = new Set(rawData.map(record => record.date.split(' ')[0])).size;
                document.getElementById('uniqueDates').textContent = uniqueDates;
            }
            if (document.getElementById('avgDailyOperations')) {
                document.getElementById('avgDailyOperations').textContent = bi.avg_daily_operations ? bi.avg_daily_operations.toFixed(1) : '-';
            }

            // Update cost-benefit analysis
            if (document.getElementById('totalRedemptionValue')) {
                document.getElementById('totalRedemptionValue').textContent = bi.total_revenue ? bi.total_revenue.toLocaleString() : '-';
            }
            if (document.getElementById('perTruckRevenueDisplay')) {
                document.getElementById('perTruckRevenueDisplay').textContent = bi.avg_revenue_per_truck ? bi.avg_revenue_per_truck.toLocaleString() : '-';
            }
            if (document.getElementById('highestRevenueTruck')) {
                document.getElementById('highestRevenueTruck').textContent = bi.highest_revenue_truck || '-';
            }
            if (document.getElementById('highestRevenueAmount')) {
                // Find highest revenue from truck details
                if (data.truckDetails) {
                    const highestRevenueTruck = data.truckDetails.reduce((a, b) => a.Total_Revenue > b.Total_Revenue ? a : b);
                    document.getElementById('highestRevenueAmount').textContent = highestRevenueTruck.Total_Revenue.toLocaleString();
                }
            }
            if (document.getElementById('roiOpportunityTruck')) {
                document.getElementById('roiOpportunityTruck').textContent = bi.highest_revenue_truck || '-';
            }
        }

        // Function to update all new business intelligence sections
        function updateBusinessIntelligenceSections(data) {
            console.log('updateBusinessIntelligenceSections called');
            console.log('Calling updatePricingAnalysis...');
            updatePricingAnalysis(data);
            console.log('Calling updateOperationalEfficiency...');
            updateOperationalEfficiency(data);
            console.log('Calling updateWasteManagement...');
            updateWasteManagement(data);
            console.log('Calling updateStrategicBI...');
            updateStrategicBI(data);
            console.log('All business intelligence sections updated');
        }

        // Initialize the dashboard
        function initDashboard() {
            console.log('Dashboard initialization started...');
            // Load data from JSON file instead of hardcoded data
            loadDataFromJSON();
        }

        // Call initialization when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);
        
        // Also try to initialize after a short delay in case of timing issues
        setTimeout(() => {
            console.log('Delayed dashboard initialization...');
            if (typeof loadDataFromJSON === 'function') {
                loadDataFromJSON();
            }
        }, 1000);
        
        // Direct operational efficiency fix
        setTimeout(() => {
            console.log('Direct operational efficiency fix...');
            fetch('../python_analyzers/dashboard_data.json')
                .then(response => response.json())
                .then(data => {
                    if (data.operationalEfficiency) {
                        console.log('Direct fix: Updating operational efficiency...');
                        updateOperationalEfficiency(data);
                    }
                })
                .catch(error => {
                    console.error('Direct fix error:', error);
                });
        }, 2000);
    </script>
</body>
</html>
